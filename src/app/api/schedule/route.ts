import{NextResponse}from'next/server';import{sbServer}from'@/lib/supabase/server';export async function POST(req:Request){const b=await req.json();if(!b?.post_id||!Array.isArray(b?.channel_ids)||!b?.run_at)return NextResponse.json({ok:false,error:'Missing post_id/channel_ids/run_at'},{status:400});const sb=sbServer();const rows=b.channel_ids.map((cid:string)=>({post_id:b.post_id,channel_id:cid,run_at:b.run_at,status:'pending',attempts:0}));const{data,error}=await sb.from('scheduled_jobs').insert(rows).select('id');if(error)return NextResponse.json({ok:false,error:error.message},{status:400});return NextResponse.json({ok:true,count:data.length});}